# 1. Цель проекта

Цель проекта - разработать систему хранения и управления тренировками. Дополнить систему управлением веса тела пользователя, калькулятором одноповторного  максимума и историей подходов каждого упражнения, сопровождающейся графиками. Система должна интегрироваться с Telegram и иметь полный функционал как из чата и Telegram Web App, так и в качестве Web-сайта. 

# 2. Описание системы

Основные системные блоки:

1. Регистрация, аутентицикация, авторизация.
2. Работа с шаблонами тренировок.
3. Работа с тренировками.
4. Работа с весом пользователя.
5. Калькулятор одноповторного максимума.
6. Функционал для отправки оповещений.
7. Функционал для быстрого поиска записей.

## 2.1. Регистрация, аутентицикация, авторизация

Поля необходимые для регистрации пользователей:

* username
* email
* password

После успешной регистрации на указанную почту должно поступить письмо с одноразовым кодом для подтверждения аккаунта.

Поля необходимые для входа пользователей:

* username/ email
* password

В Telegram регистрация/ вход осуществляется только через Telegram Web App.

## 2.2. Шаблоны строк для управления упражнениями в тренировке

Шаблон добавления подхода:
```+ <название упражнения> <вес снаряда> <кол-во повторений>```

Шаблон изменения подхода:
```# <номер подхода> <вес снаряда> <кол-во повторений>```

Шаблон удаления подхода:
```- <номер подхода>```

* **номер подхода** - это порядковый номер подхода в пределах данной тренировки.

* **название упражнения** - это название упражнения (не дословное), оно будет сравниваться с существующими в базе и наиболее подходящие будут предложены пользователю на выбор, если переданное название однозначно определяет одно упражнение, то работа продолжится с ним и иные варианты предложены не будут. Реализация через ElasticSearch.

* **вес снаряда** - вес в условных единицах, так как единица измерения веса в данной программе не играет роли. Также вес может быть указан в процентах, но для этого требуется наличие одноповторного максимума, установленного для этого упражнения, от которого и будет расчитываться вес снаряда в подходе, тип данных - ```число с плавающей точкой```.

* **кол-во повторений** - целое число повторений.

Пример изменения подхода:
```# 3 100 5```

Пример добавления подхода:
```+ жим лёжа 110 1```

Пример удаления подхода:
```- 5```

## 2.3. Работа с шаблонами тренировок

Создание шаблона тренировки начинается с ввода названия и последующего выбора упражнений (с возможностью указания количества повторов и веса снаряда). На Веб-странице переходы должны быть реализованы посредством выпадающего меню, в чате Telegram через шаблоны управжнений.

Создание данных о шаблоне тренировки в БД происходит только после полного заполнения шаблона (нет промежуточных состояний, нет шаблона без управжнений).

Шаблону можно индивидуально задать время перерыва между подходами.

Получив список шаблонов можно перейти в меню редактирования.

## 2.4. Работа с тренировками

Начать тренировку можно как по имеющемуся шаблону, так и с нуля заполняя упражнения в течении тренировки.

Управление упражнениями у пустой тренировки (созданной не по шаблону) идентично управлению упражнениями в шаблоне. Функционал взаимодействия с упражнениями у тренировки по шаблону расширется возможностью добавить подход идущий следующим в шаблоне.

Время перерыва между подходами устанавливается либо от шаблона тренировки, либо от глобального времени перерыва (если была начата пустая тренировка).

Необходим функционал для того, чтобы открыть меню взаимодействия с текущей начатой тренировкой.

Не может быть более одной активной (не завершённой) тренировки.

## 2.5. Работа с весом пользователя

Должна быть возможность ввода текущего веса пользователя, просмотр данных о прошлых измерениях и график изменения веса.

Из чата Telegram должна иметься возможность только добавления нового измерения, просмотр графика и предыдущих измерений возможен только через Telegram Web App.

## 2.6. Калькулятор одноповторного максимума

Калькулятор должен предоставлять информацию о одноповторном максимуме при вводе веса снаряда и количестве повторений.

Из чата Telegram имеется возможность ввода данных для вычислений и получения среднего результата по нескольким формулам следующим сообщением. На веб-странице показываются данные всех формул, не только среднее значение.

## 2.7. Функционал для отправки оповещений

После добавления подхода в тренировке, заранее создаётся задача в Celery для оповещения пользователя о окончании перерыва, которая отработает через n секунд, где n - время перерыва между подходами.

При добавлении нового подхода, окончании тренировки и любого другого функционала, при котором ранняя отработка существующей задачи на оповещение должна быть прекращена, задача удаляется из очереди.

## 2.8. Функционал для быстрого поиска записей

Быстрый поиск осуществляется через ElasticSearch, при добавлении записей таблицы PostgreSQL "Excercise", они также будут дублироваться в ElasticSearch.

# 3. Стек технологий

Технологии, используемые для реализации данной системы:

* Backend:
    - язык Python
    - фреймворк Django
    - БД PostgreSQL
    - очеред задач Celery, брокер Redis
    - поискавая система ElasticSearch


* Telegram service:
    - фреймворк Aiogram
    - кэш Redis

* Fronend: 
    - React
